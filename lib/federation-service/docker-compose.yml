version: '3.7'

services:
  federation-service:
    build:
      context: $PWD/lib/federation-service/federation_service
      args:
        venv_python: "${VENV_PYTHON}"
        alpine_version: "${ALPINE_VERSION}"
    image: ${DOCKER_REGISTRY}/federation-service:${FEDERATION_VERSION:-latest}
    ports:
      - "${FEDERATION_PORT}:4232"
    secrets:
      - source: federation-servers
        target: /app/federation_service/configs/servers.json
      - source: federation-services
        target: /app/federation_service/configs/services.json
    extra_hosts:
        - "docker.localhost:${LOCAL_IP_ADDR}"
    entrypoint: ["uwsgi", "federation.ini", "--http", "0.0.0.0:4232"]
