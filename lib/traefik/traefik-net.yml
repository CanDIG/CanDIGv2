version: '3.7'

services:
  traefik-net:
    image: traefik
    networks:
      - ${DOCKER_NET:-bridge}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - ${TRAEFIK_HTTP_PORT:-80}:80
      - ${TRAEFIK_UI_PORT:-8080}:8080
    deploy:
      labels:
        - "traefik.port=${TRAEFIK_UI_PORT:-8080}"
        - "traefik.docker.network=${DOCKER_NET:-bridge}"
        - "traefik.frontend.rule=Host:traefik.${MINIO_DOMAIN:-localhost}"
    command:
      - traefik
      - --api
      - --consul
      - --consul.endpoint=consul:${CONSUL_HTTP_PORT:-8500}
      - --consulcatalog.endpoint=consul:${CONSUL_HTTP_PORT:-8500}
      - --docker
      - --docker.${DOCKER_MODE:-network}
      - --docker.domain=${MINIO_DOMAIN:-localhost}
      - --docker.watch

networks:
  traefik_net:
    external: true
