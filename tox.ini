[tox]
skipsdist = True
envlist = 
    py37,
    minio,
    chord_drs,
    htsget,
    federation_service,
    metadata_service

[testenv]
skip_install = true
whitelist_externals=
    screen
    mkdir

[testenv:minio]
commands=
    mkdir -p {toxinidir}/data
    screen -dmS {envname} {toxinidir}/bin/minio server {toxinidir}/data

[testenv:chord_drs]
changedir={toxinidir}/lib/drs-server/chord_drs
deps=-r{toxinidir}/lib/drs-server/chord_drs/requirements.txt

commands =
    flask db upgrade
    screen -dmS {envname} flask run --host 0.0.0.0 --port {env:CHORD_DRS_PORT}

[testenv:htsget]
deps=-r{toxinidir}/lib/htsget-server/htsget_app/requirements.txt
changedir={toxinidir}/lib/htsget-server/htsget_app

commands = 
    python setup.py install
    screen -dmS {envname} python htsget_server/server.py

[testenv:federation_service]
deps=
    -r{toxinidir}/lib/federation-service/federation_service/requirements.txt
changedir={toxinidir}/lib/federation-service/federation_service

skip_install = true

commands = 
    screen -dmS {envname} python -m candig_federation --host {env:FEDERATION_SERVICE_IP} --port {env:FEDERATION_SERVICE_PORT} 

[testenv:metadata_service]
deps=-r{toxinidir}/lib/metadata_service/metadata_service_v2/requirements.txt
changedir={toxinidir}/lib/metadata_service/metadata_service_v2/

skip_install = true

commands=
    screen -dmS {envname} ./manage.py runserver {env:METADATA_SERVICE_IP}:{env:METADATA_SERVICE_PORT}

[testenv:cnv_service]
changedir={toxinidir}/lib/cnv_service/candig_cnv_service

commands=
    python setup.py install
    screen -dmS {envname} candig_cnv_service --host {env:CNV_SERVICE_HOST} --port {env:CNV_SERVICE_PORT}
